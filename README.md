# test_task
## API для просмотра транзакций
### Пагинация
Пагинация реализована с помощью Keyset метода: имеем размер страницы: 20 (согласно условию задачи)\
и курсор - date_time значение последней из 20 переданных транзакций. Если хотим получить следующие 20 транзакций,\
то передаем в запрос курсор, и система выдаст нам следующие 20 транзакций, date_time которых < cursor.\
Для получения первых 20 транзакций cursor не указываем. Если при первом запросе транзакций пришло\
меньше, чем 20, то, соответственно, транзакций с таким фильтром меньше 20.

### Запросы
* **/update_transactions_data** - POST-запрос. На входе ожидает файлы incomes.csv и outcomes.csv\
  Читает каждый из этих файлов как поток без накопления всего содержимого в памяти, записывает их в создаваемую папку uploads, затем импортирует данные из этих файлов в локальную базу данных внутри микросервиса.. 
 При повторном вызове перезаписывает данные внутри базы данных, удаляя старые записи и загружая туда новые из переданных в запросе файлов. При успешной записи данных возвращает сообщение об этом.
  Была реализована именно перезапись, так как пользователя приложения, в которое будут передаваться транзакции, будут интересовать
  в основом самые недавние транзакции, и только иногда транзакции умеренной давности. Если бы вместо перезаписи было реализовано дополнение
  базы данных новыми данными, то это приводило бы к сильному переполнению базы данных потенциально бесполезными данными. Также это создавало
  бы риск случайной загрузки в базу данных уже присутствующих там данных и их дублирования, что создавало бы еще дополнительную нагрузку на
  микросервис и портило бы пользовательский опыт, так как какие-то транзакции пользователя были бы продублированы.
* **/get_user_transactions** - GET-запрос. На входе ожидает ID пользователя и (опционально)\
  значение для курсора пагинации. Возвращает список транзакций пользователя размера от 0 до 20.\
  Транзакции идут от самых последних к самым ранним.
* **/get_user_account_transactions** - GET-запрос. На входе ожидает ID пользователя, ID счета и (опционально)\
  значение для курсора пагинации. Возвращает список транзакций пользователя по конкретному счету. Список размера от 0 до 20.\
  Транзакции идут от самых последних к самым ранним.
* **/get_user_transactions_by_date** - GET-запрос. На входе ожидает ID пользователя, дату совершения транзакций и (опционально)\
  значение для курсора пагинации. Возвращает список транзакций пользователя, выполненных в указанную дату. Список размера от 0 до 20.\
  Дата формата YYYY-MM-DD. Транзакции идут от самых последних к самым ранним.
 * **/get_user_account_transactions_by_date** - GET-запрос. На входе ожидает ID пользователя, ID счета, дату совершения транзакций,\
   и (опционально) значение для курсора пагинации. Возвращает список транзакций пользователя по конкретному счету, выполненных в указанную дату.\
   Список размера от 0 до 20. Дата формата YYYY-MM-DD. Транзакции идут от самых последних к самым ранним.

### База данных
DuckDB

### Тесты
Для всех 4 запросов написан единый тест в файле RequestsTests. В нем на небольшом тестовом искусственном наборе данных проверяется\
корректность результатов работы запросов.\
**Важно:** тестовый вызов /update_transactions_data все еще работает с изначальной базой данных, перезаписывая ее. После\
теста необходимо снова загрузить рабочие incomes.csv и outcomes.csv файлы с помощью /update_transactions_data при запуске микросервиса.

   
